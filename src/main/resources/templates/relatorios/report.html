<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>SisCultural - Programas</title>

    <!-- CSS's-->


    <link href="css/bootstrap-theme.min.css" rel="stylesheet"/>
    <link href="css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="css/style.css" type="text/css"/>
    <link rel="stylesheet" href="css/bootstrap-datetimepicker.min.css" type="text/css"/>
    <link rel="stylesheet" href="css/bootstrap-select.min.css" type="text/css"/>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>


</head>

    <body class="home-body">

        <header th:include="menu_header :: header"></header>

        <div class="container"  style="margin-bottom: 50px">

            <div class="">
                <ol class="breadcrumb">
                    <li><a href="home">Home</a></li>
                    <li class="active">Relatório</li>
                </ol>
            </div>

            <div>

                <!-- Nav tabs -->
                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" ><a href="#home" aria-controls="home" role="tab" data-toggle="tab">Atividades e Público por Programa</a></li>
                    <li role="presentation" class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
                            Público por Mês <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">Tabela</a></li>
                            <li role="presentation" class="active"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">Em Barras</a></li>
                        </ul>
                    </li>
                    <li role="presentation"><a href="#settings" aria-controls="settings" role="tab" data-toggle="tab">Público Total</a></li>
                </ul>

                <!-- Tab panes -->
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane " id="home">
                        <div class="container-fluid col-md-8 col-md-offset-2" style="background: white">
                            <h3 class="text-center">Quantidade de Atividades e Público por Programa</h3>

                            <div class="form-group col-md-5">
                                <label for="datetimepicker2" class="control-label">Início</label>
                                <div class="form-group">
                                    <div class='input-group date' id='datetimepicker2'>
                                        <input type='text' class="form-control" name="inicialDate" />
                                        <span class="input-group-addon">
                                                            <span class="glyphicon glyphicon-calendar"></span>
                                                        </span>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group col-md-5">
                                <label for="datetimepicker3" class="control-label">Fim</label>
                                <div class="form-group">
                                    <div class='input-group date' id='datetimepicker3'>
                                        <input type='text' class="form-control" name="finalDate"/>
                                        <span class="input-group-addon">
                                                            <span class="glyphicon glyphicon-calendar"></span>
                                                        </span>
                                    </div>
                                </div>
                            </div>


                            <div class='form-group col-md-12'>
                                <!--<label for="" class="control-label col-md-14">  </label>-->
                                <div class="form-group">
                                    <button class="btn btn-success" onclick="consultar()">Buscar</button>
                                </div>

                            </div>

                            <div id="table_div"></div>

                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="profile">
                        <div class="container-fluid col-md-8 col-md-offset-2" style="background: white">
                            <h3 class="text-center">Público por mês</h3>

                            <div class="form-group col-md-5">
                                <label for="datetimepicker4" class="control-label">Início</label>
                                <div class="form-group">
                                    <div class='input-group date' id='datetimepicker4'>
                                        <input type='text' class="form-control" name="inicialDate2" />
                                        <span class="input-group-addon">
                                                            <span class="glyphicon glyphicon-calendar"></span>
                                                        </span>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group col-md-5">
                                <label for="datetimepicker5" class="control-label">Fim</label>
                                <div class="form-group">
                                    <div class='input-group date' id='datetimepicker5'>
                                        <input type='text' class="form-control" name="finalDate2"/>
                                        <span class="input-group-addon">
                                                            <span class="glyphicon glyphicon-calendar"></span>
                                                        </span>
                                    </div>
                                </div>
                            </div>


                            <div class='form-group col-md-12'>
                                <!--<label for="" class="control-label col-md-14">  </label>-->
                                <div class="form-group">
                                    <button class="btn btn-success" onclick="consultar2()">Buscar</button>
                                </div>

                            </div>

                            <div id="table_div2" style="padding-bottom: 50px"></div>

                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane active" id="messages">
                        <div class="container-fluid col-md-8 col-md-offset-2" >
                            <h3 class="text-center">Público por mês 2</h3>

                            <div id="table_div3" class="col-md-8 col-md-offset-1"></div>

                            <div class="form-group col-md-5  col-md-offset-1">
                                <label for="datetimepicker6" class="control-label">Início</label>
                                <div class="form-group">
                                    <div class='input-group date' id='datetimepicker6'>
                                        <input type='text' class="form-control" name="inicialDate2" />
                                        <span class="input-group-addon">
                                                            <span class="glyphicon glyphicon-calendar"></span>
                                                        </span>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group col-md-5">
                                <label for="datetimepicker7" class="control-label">Fim</label>
                                <div class="form-group">
                                    <div class='input-group date' id='datetimepicker7'>
                                        <input type='text' class="form-control" name="finalDate2"/>
                                        <span class="input-group-addon">
                                                            <span class="glyphicon glyphicon-calendar"></span>
                                                        </span>
                                    </div>
                                </div>
                            </div>


                            <div class='form-group col-md-12  col-md-offset-1'>
                                <!--<label for="" class="control-label col-md-14">  </label>-->
                                <div class="form-group">
                                    <button class="btn btn-success" onclick="consultar3()">Buscar</button>
                                </div>

                            </div>

                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="settings">
                        <div class="container-fluid col-md-8 col-md-offset-2" >
                            <h3 class="text-center">Público Total</h3>

                            <div id="table_div4" class="col-md-8 col-md-offset-1"></div>

                            <div class='form-group col-md-12  col-md-offset-1'>
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox" id="diasFechados" /> Considerar dias fechados
                                    </label>
                                </div>
                                <div class="form-group">
                                    <button class="btn btn-success" onclick="consultar4()">Buscar</button>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>


        <footer class="navbar navbar-default navbar-fixed-bottom text-center">
            <p class="text-muted">Desenvolvido por <a href="https://github.com/Hero-Code">Circo de Soled</a></p>
        </footer>


        <script src="js/jquery-3.1.0.min.js"></script>
        <script src="js/moment.js"></script>

        <script src="js/bootstrap.min.js"></script>
        <script src="js/bootstrap-datetimepicker.min.js"></script>
        <script src="js/locale/pt-br.js"></script>
        <script src="js/bootstrap-select.min.js"></script>

        <script src="js/tableselection.js"></script>
        <!--<script src="https://use.fontawesome.com/42680f3b68.js"></script>-->
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <style>
            .mytable {
                font-family: Alte DIN, sans-serif;
                font-size: 16px;
            }

            .google-visualization-table-table{
                font-family: Alte DIN, sans-serif;
                font-size: 16px;
            }
            .google-visualization-table-th{
                text-align: center;
            }
            .google-visualization-table-td-number{
                text-align: center;
            }

            .table .google-visualization-table-tr-odd, .table .google-visualization-table-tr-even {
                background-color: transparent;
            }
            #ChartOverview .table {
                margin-bottom: 0;
            }
            .TotalRow {
                background-color: #e4e9f4;
            }
            .TotalRow td {
                background-color: #e4e9f4;
                background-image:linear-gradient(to bottom, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.7) 30%, rgba(255, 255, 255, 0.5) 60%, rgba(255, 255, 255, 0) 100%);
                font-weight : 700;
            }

        </style>
        <script type="text/javascript">

            var meses = {
                '01': 'Janeiro',
                '02': 'Fevereiro',
                '03': 'Março',
                '04': 'Abril',
                '05': 'Maio',
                '06': 'Junho',
                '07': 'Julho',
                '08': 'Agosto',
                '09': 'Setembro',
                '10': 'Outubro',
                '11': 'Novembro',
                '12': 'Dezembro'
            };

            $(function () {

                $('#datetimepicker2').datetimepicker({
                    locale: 'pt-br'
                });

                $('#datetimepicker3').datetimepicker({
                    locale: 'pt-br'
                });

                $('#datetimepicker4').datetimepicker({
                    locale: 'pt-br',
                    format: 'L'
                });

                $('#datetimepicker5').datetimepicker({
                    locale: 'pt-br',
                    format: 'L'
                });

                $('#datetimepicker6').datetimepicker({
                    locale: 'pt-br',
                    format: 'L'
                });

                $('#datetimepicker7').datetimepicker({
                    locale: 'pt-br',
                    format: 'L'
                });

            });
            google.charts.load('current', {'packages':['table', 'corechart', 'bar', 'line'], 'language': 'pt_BR'});
//            google.charts.setOnLoadCallback(drawTable);


            function resetStyling(id) {
                $('#' + id + ' table')
                    .removeClass('google-visualization-table-table')
                    .addClass('mytable')
                    .addClass('table table-bordered table-condensed table-striped table-hover');
                var parentRow = $('#' + id + ' td.TotalCell').parent();
                parentRow.addClass('TotalRow');
            }

            function consultar(){
                var iDate = $('#datetimepicker2').find("input").val();
                var fDate = $('#datetimepicker3').find("input").val();

                $.getJSON('/report2',
                    {
                        inicialDate: iDate,
                        finalDate: fDate
                    },

                    function (result) {

                        var data = new google.visualization.DataTable();
                        data.addColumn('string', 'Programa');
                        data.addColumn('number', 'Atividades');
                        data.addColumn('number', 'Público');

                        var ativ = 0;
                        var publico = 0;
                        for (var i in result) {
                            console.log(result[i]);
                            ativ += result[i][1];
                            publico += result[i][2];
                            data.addRow(result[i]);
                        }

                        data.addRow([{
                            v: 'Total',
                            p: {
                                className: 'TotalCell'
                            }
                        }, ativ, publico]);


                        var table = new google.visualization.Table(document.getElementById('table_div'));

                        //add the listener events
                        google.visualization.events.addListener(table, 'ready', function () {
                            resetStyling('table_div');
                        });

                        //sorting event
                        google.visualization.events.addListener(table, 'sort', function (ev) {
                            //find the last row
                            var parentRow = $('#table_div td.TotalCell').parent();
                            //set the TotalRow row to the last row again.
                            if (!parentRow.is(':last-child')) {
                                parentRow.siblings().last().after(parentRow);
                            }

                            //reset the styling of the table
                            resetStyling('table_div');
                        });

                        var options = {
                            fontName: 'Alte DIN',
                            showRowNumber: false,
                            width: '100%',
                            height: '100%'
                        };

                        table.draw(data, options);
                    });

            }

            function consultar2(){

                var iDate2 = $('#datetimepicker4').find("input").val();
                var fDate2 = $('#datetimepicker5').find("input").val();

                $.getJSON('/getMonth',
                    {
                        inicialDate: iDate2,
                        finalDate: fDate2
                    },

                    function (result) {

                        var data2 = new google.visualization.DataTable();
                        data2.addColumn('string', 'Mês');
                        data2.addColumn('number', 'Público');

                        var total = 0;

                        for (var i in result) {
                            console.log(result[i]);
                            total += result[i][1];
                            data2.addRow(result[i]);
                        }

                        data2.addRow([{
                            v: 'Total',
                            p: {
                                className: 'TotalCell'
                            }
                        }, total]);

                        var table2 = new google.visualization.Table(document.getElementById('table_div2'));

                        //add the listener events
                        google.visualization.events.addListener(table2, 'ready', function () {
                            resetStyling('table_div2');
                        });

                        //sorting event
                        google.visualization.events.addListener(table2, 'sort', function (ev) {
                            //find the last row
                            var parentRow = $('#table_div2 td.TotalCell').parent();
                            //set the TotalRow row to the last row again.
                            if (!parentRow.is(':last-child')) {
                                parentRow.siblings().last().after(parentRow);
                            }

                            //reset the styling of the table
                            resetStyling('table_div2');
                        });

                        var options = {
                            fontName: 'Alte DIN',
                            showRowNumber: false,
                            width: '100%',
                            height: '100%'
                        };

                        table2.draw(data2, options);
                    });

            }

            function consultar3(){

                var iDate2 = $('#datetimepicker6').find("input").val();
                var fDate2 = $('#datetimepicker7').find("input").val();

                $.getJSON('/getMonth',
                    {
                        inicialDate: iDate2,
                        finalDate: fDate2
                    },

                    function (result) {

                        var data2 = new google.visualization.DataTable();
                        data2.addColumn('string', 'Mês');
                        data2.addColumn('number', 'Público');
                        data2.addColumn({type: 'string', role: 'annotation'});

                        var total = 0;

                        for (var i in result) {

                            var mes = result[i][0];

                            if (!mes.startsWith("1") || mes == '1') {
                                result[i][0] = '0' + mes;
                            }
                        }

                        result.sort({column: 0});

                        for (var i in result) {
                            total += result[i][1];
                            var mes = result[i][0];

                            data2.addRow([meses[mes], result[i][1], result[i][1].toString()]);
                        }
                        var view = new google.visualization.DataView(data2);

                        view.setColumns([0, 1,
                            { calc: "stringify",
                                sourceColumn: 1,
                                type: "string",
                                role: "annotation" }]);

                        var options = {
                            series: {
                                0: {
                                    type: 'bars'
                                },
                                1: {
                                    type: 'line',
                                    color: 'grey',
                                    lineWidth: 0,
                                    pointSize: 0,
                                    visibleInLegend: false
                                }
                            },
                            height: 400,
                            width: 600,
                            title: 'Público por Mês - Entre ' + iDate2 + ' e ' + fDate2,
                            legend: { position: 'none' },
                            chart: { subtitle: 'Entre ' + iDate2 + ' e ' + fDate2 },
                            vAxis: {format: 'decimal'},
                            bar: { groupWidth: "70%" }
                        };

                        var chart = new google.visualization.ComboChart(document.getElementById('table_div3'));

                        google.visualization.events.addListener(chart, 'click', function () {
                            var imgUri = chart.getImageURI();
                            window.open(imgUri);
                        });
                        chart.draw(view, google.charts.Bar.convertOptions(options));
                    });

            }

            function consultar4(){

                $.getJSON('/getAll',

                    function (result) {

                        var data2 = new google.visualization.DataTable();
                        data2.addColumn('date', 'Dias');
                        data2.addColumn('number', 'Público');

//                        console.log(result[10,2]);

                        for (var i in result){
                            var _date = result[0, i]['date'];
                            var dateFormatted = new Date(_date.year, _date.monthValue -1, _date.dayOfMonth);
                            var _score = result[0, i]['mainPublicScore'];

//                            console.log([dateFormatted, _score] );
//                            console.log(i + ' ' + $('#diasFechados').prop('checked'));
                            if ($('#diasFechados').prop('checked')== true) {
                                data2.addRow([dateFormatted, _score]);
                            } else
                                if (_score > 0)
                                    data2.addRow([dateFormatted, _score]);

//                            console.log(i + ' ' + result[i,3]);
                        }

                        data2.sort({column: 0, desc: true});
//                        var view = new google.visualization.DataView(data2);

                        var options = {
                            width: 600,
                            height: 400,
                            hAxis: {
                                title: 'Dias'
                            },
                            vAxis: {
                                title: 'Público'
                            }
                        };

                        var chart = new google.visualization.LineChart(document.getElementById('table_div4'));

                        google.visualization.events.addListener(chart, 'click', function () {
                            var imgUri = chart.getImageURI();
                            window.open(imgUri);
                        });
                        chart.draw(data2, google.charts.Bar.convertOptions(options));
                    });

            }
        </script>


    </body>

</html>
